<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i gi·∫£i m√£ b·∫£n ƒë·ªì kho b√°u</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .btn {
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
            background-color: #9ca3af; /* Tailwind gray-400 */
        }
        /* N√∫t K·∫ø Ti·∫øp m·ªõi */
        .btn-next {
            background-color: #facc15; /* Tailwind yellow-400 */
            color: #111827; /* Tailwind gray-900 */
            font-weight: 700;
        }
        .btn-next:hover:not(:disabled) {
            background-color: #f59e0b; /* Tailwind amber-500 */
        }
        .answer-btn.correct {
            background-color: #22c55e !important;
            color: white !important;
            border-color: #16a34a !important;
        }
        .answer-btn.incorrect {
            background-color: #ef4444 !important;
            color: white !important;
            border-color: #dc2626 !important;
        }
        #result-screen h1 {
            animation: pop-in 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        #final-score {
             animation: score-pop 0.8s 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) backwards;
        }
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes score-pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        #image-reveal-container {
            position: relative;
            aspect-ratio: 1.25 / 1; /* Adjusted for 5x4 grid */
            overflow: hidden;
            border-radius: 1rem;
            background-color: #e2e8f0;
        }
        #image-tiles-grid {
            position: absolute;
            inset: 0;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr); /* 5x4 grid for 20 tiles */
            gap: 2px;
        }
        .tile {
            background-color: #374151;
            transition: opacity 0.7s ease-in-out, transform 0.7s ease-in-out;
            opacity: 1;
            transform: scale(1);
        }
        .tile.revealed {
            opacity: 0;
            transform: scale(0.8);
        }
    </style>
</head>
<!-- C·∫¢I TI·∫æN: Th√™m padding cho m√†n h√¨nh l·ªõn h∆°n (md:p-8) -->
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8">

    <!-- C·∫¢I TI·∫æN: TƒÉng max-width ƒë·ªÉ t·∫≠n d·ª•ng kh√¥ng gian tr√™n m√†n h√¨nh desktop -->
    <div class="w-full max-w-5xl mx-auto">
        <!-- Giao di·ªán 1: Welcome Screen -->
        <div id="welcome-screen" class="card p-6 sm:p-8 md:p-10 text-center max-w-2xl mx-auto">
              <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-4 flex items-center justify-center gap-3">
                  <span>üß© Gi·∫£i m√£ b·∫£n ƒë·ªì kho b√°u</span>
              </h1>
              <img src="https://i.postimg.cc/B60pfx8L/H-nh-n-n.png" alt="Gi·∫£i m√£ b·∫£n ƒë·ªì kho b√°u" class="w-full max-w-md mx-auto rounded-lg my-6">
              <button id="welcome-next-btn" class="btn btn-next w-full py-3 px-6 rounded-lg shadow-lg">
                  <span>K·∫ø ti·∫øp</span>
              </button>
        </div>

        <!-- Giao di·ªán 2: Instructions Screen -->
        <div id="instructions-screen" class="card p-6 sm:p-8 md:p-10 text-center max-w-2xl mx-auto hidden">
              <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-4">H∆∞·ªõng d·∫´n ch∆°i</h1>
              <p class="text-gray-600 mb-6 text-left sm:text-center">B·∫±ng c√°ch tr·∫£ l·ªùi ƒë√∫ng c√°c c√¢u h·ªèi, h√£y gi√∫p nh√¢n v·∫≠t t·ª´ng b∆∞·ªõc l·∫≠t gi·ªü c√°c m·∫£nh gh√©p ƒë·ªÉ t√¨m ra t·∫•m b·∫£n ƒë·ªì b√≠ ·∫©n ch·ªâ ƒë∆∞·ªùng t·ªõi Kho B√°u. B·∫°n s·∫Ω c√≥ trong tay t·∫•m b·∫£n ƒë·ªì ho√†n ch·ªânh n·∫øu tr·∫£ l·ªùi ƒë√∫ng h·∫øt c√°c c√¢u h·ªèi.</p>
              <img src="https://i.postimg.cc/sxR5hyPM/H-ng-d-n.png" alt="H∆∞·ªõng d·∫´n ch∆°i" class="w-full max-w-md mx-auto rounded-lg my-6">
              <button id="instructions-next-btn" class="btn btn-next w-full py-3 px-6 rounded-lg shadow-lg">
                  <span>K·∫ø ti·∫øp</span>
              </button>
        </div>

        <!-- Giao di·ªán 3: M√†n h√¨nh th√¥ng tin ng∆∞·ªùi ch∆°i -->
        <div id="start-screen" class="card p-6 sm:p-8 md:p-10 text-center max-w-2xl mx-auto hidden">
              <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-6 flex items-center justify-center gap-3">
                  <span>Th√¥ng tin ng∆∞·ªùi ch∆°i</span>
              </h1>
              <div class="space-y-4 mb-6">
                  <div class="relative">
                      <i class="fa-solid fa-building absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 z-10"></i>
                      <input type="text" id="department" placeholder="Nh·∫≠p ho·∫∑c ch·ªçn b·ªô ph·∫≠n..." autocomplete="off" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                      <div id="department-suggestions" class="absolute z-20 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-lg hidden">
                      </div>
                  </div>
                  <div class="relative">
                      <i class="fa-solid fa-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                      <input type="text" id="playerName" placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n..." class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
              </div>
              <button id="start-btn" class="btn w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700" disabled>
                  <i class="fa-solid fa-play"></i>
                  <span>B·∫Øt ƒê·∫ßu</span>
              </button>
              <p id="name-error" class="text-red-500 mt-4 hidden">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!</p>
        </div>

        <!-- M√†n h√¨nh c√¢u h·ªèi -->
        <div id="quiz-screen" class="card p-4 sm:p-6 md:p-8 hidden">
             <!-- C·∫¢I TI·∫æN: ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch (gap) theo k√≠ch th∆∞·ªõc m√†n h√¨nh -->
            <div class="md:grid md:grid-cols-2 md:gap-6 lg:gap-8 items-start">
                <!-- C·ªôt b√™n tr√°i: H√¨nh ·∫£nh -->
                <div id="image-reveal-container" class="mb-6 md:mb-0">
                    <img src="https://i.postimg.cc/QNpv1Scw/gia-tri-cot-loi-Toan-Phat.png" class="w-full h-full object-cover" alt="H√¨nh ·∫£nh b√≠ ·∫©n" id="quiz-image">
                    <div id="image-tiles-grid">
                    </div>
                </div>
                <!-- C·ªôt b√™n ph·∫£i: C√¢u h·ªèi v√† tr·∫£ l·ªùi -->
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-sm font-medium text-gray-600 bg-gray-100 py-1 px-3 rounded-full flex items-center gap-2">
                            <i class="fa-solid fa-list-ol text-gray-500"></i>
                            <span>C√¢u <span id="current-question-number"></span> / 20</span>
                        </p>
                        <div class="text-lg font-bold text-blue-600 bg-blue-50 py-1 px-4 rounded-full flex items-center gap-2">
                            <i class="fa-solid fa-star text-yellow-400"></i>
                            <span>ƒêi·ªÉm: <span id="score">0</span></span>
                        </div>
                    </div>
                    <h2 id="question" class="text-md sm:text-lg font-semibold text-gray-800 mb-6 flex-grow flex items-center min-h-[120px]"></h2>
                    <div id="answers" class="grid grid-cols-1 gap-3 mt-auto">
                    </div>
                </div>
            </div>
        </div>

        <!-- M√†n h√¨nh k·∫øt qu·∫£ -->
        <div id="result-screen" class="card p-6 sm:p-8 hidden">
            <!-- C·∫¢I TI·∫æN: ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch (gap) theo k√≠ch th∆∞·ªõc m√†n h√¨nh -->
            <div class="md:grid md:grid-cols-2 md:gap-6 lg:gap-8 items-center">
                <div id="result-image-container" class="mb-6 md:mb-0">
                </div>
                <div class="text-center">
                    <i id="result-icon" class="fa-solid fa-trophy text-7xl mb-4"></i>
                    <h1 id="result-title" class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4"></h1>
                    <p id="result-message" class="text-lg sm:text-xl text-gray-600 mb-6"></p>

                    <p class="text-xl sm:text-2xl text-gray-700 mb-2">ƒêi·ªÉm cu·ªëi c√πng c·ªßa b·∫°n l√†:</p>
                    <p class="text-5xl sm:text-6xl font-bold text-blue-600 mb-4" id="final-score"></p>
                    
                    <p id="effort-message" class="text-gray-600 mb-4 hidden"></p>

                    <p id="submission-status" class="text-gray-500 mb-4 h-5"></p>
                    <button id="restart-btn" class="btn w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700">
                        <i class="fa-solid fa-rotate-right"></i>
                        <span>Ch∆°i L·∫°i</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const departments = [
            "Ban gi√°m ƒë·ªëc", ‚ÄùBan ki·ªÉm so√°t‚Äù, "Ph√≤ng k·ªπ thu·∫≠t", "Ph√≤ng QAQC", "B·ªô ph·∫≠n kho", "Ph√≤ng k·∫ø ho·∫°ch s·∫£n xu·∫•t", 
            "Ph√≤ng v·∫≠t t∆∞", "Ph√≤ng xu·∫•t nh·∫≠p kh·∫©u", "Ph√≤ng k·∫ø to√°n t√†i ch√≠nh", "Ph√≤ng h√†nh ch√≠nh nh√¢n s·ª±", 
            "Ph√≤ng b√°n h√†ng n·ªôi", "Ph√≤ng b√°n h√†ng xu·∫•t kh·∫©u", "Ph√≤ng ph√°t tri·ªÉn h·ªá th·ªëng", "Ph√≤ng HSE", 
            "B·ªô ph·∫≠n b·∫£o v·ªá", "B·ªô ph·∫≠n ƒëi·ªán", "B·ªô ph·∫≠n c∆° kh√≠", "B·ªô ph·∫≠n l√≤ n·∫•u", "B·ªô ph·∫≠n √©p ph·∫ø", 
            "B·ªô ph·∫≠n phay - c√°n - k√©o", "B·ªô ph·∫≠n k√©o th√†nh ph·∫©m", "B·ªô ph·∫≠n k√©o ·ªëng th·∫≥ng", "B·ªô ph·∫≠n lu·ªìn x·ªëp", 
            "B·ªô ph·∫≠n tang g·ªó", "B·ªô ph·∫≠n PC - LWC", "B·ªô ph·∫≠n l√≤ ·ªß", "B·ªô ph·∫≠n ƒë√≥ng g√≥i", "B·ªô ph·∫≠n l√°i xe", 
            "B·ªô ph·∫≠n t·∫°p v·ª•", "B·ªô ph·∫≠n b·∫øp"
        ];
        
        const originalQuestions = [
            { question: "Khi m·ªôt nh√¢n vi√™n nh·∫≠n th·∫•y quy tr√¨nh l√†m vi·ªác ch∆∞a hi·ªáu qu·∫£ nh∆∞ng v·∫´n im l·∫∑ng, kh√¥ng ƒë·ªÅ xu·∫•t c·∫£i ti·∫øn, h√†nh vi n√†y ph·∫£n √°nh thi·∫øu B·∫£n lƒ©nh v∆∞∆°n m√¨nh.", answers: ["ƒê√∫ng", "Sai"], correctAnswerIndex: 0 },
            { question: "N·∫øu m·ªôt nh√¢n vi√™n lu√¥n tu√¢n th·ªß nguy√™n t·∫Øc, minh b·∫°ch trong b√°o c√°o nh∆∞ng kh√¥ng chia s·∫ª th√¥ng tin v·ªõi ƒë·ªìng ƒë·ªôi, h√†nh vi n√†y v·∫´n ph√π h·ª£p v·ªõi ƒê·ªôi h√¨nh hi·ªáu qu·∫£.", answers: ["ƒê√∫ng", "Sai"], correctAnswerIndex: 1 },
            { question: "M·ªôt nh√¢n vi√™n lu√¥n ch·ªß ƒë·ªông ph·ªëi h·ª£p li√™n ph√≤ng ban, chia s·∫ª th√¥ng tin v√† h·ªó tr·ª£ ƒë·ªìng nghi·ªáp, h√†nh vi n√†y th·ªÉ hi·ªán ƒê·ªôi h√¨nh hi·ªáu qu·∫£.", answers: ["ƒê√∫ng", "Sai"], correctAnswerIndex: 0 },
            { question: "Khi nh√¢n vi√™n t·ª´ ch·ªëi nh·∫≠n nhi·ªám v·ª• m·ªõi v√¨ s·ª£ kh√≥ khƒÉn, h√†nh vi n√†y th·ªÉ hi·ªán B·∫£n lƒ©nh v∆∞∆°n m√¨nh.", answers: ["ƒê√∫ng", "Sai"], correctAnswerIndex: 1 },
            { question: "Khi ph√°t hi·ªán ƒë·ªìng nghi·ªáp l√†m sai quy tr√¨nh, b·∫°n s·∫Ω:", answers: ["Im l·∫∑ng ƒë·ªÉ tr√°nh va ch·∫°m", "B√°o c√°o th·∫≥ng TGƒê", "G√≥p √Ω tr·ª±c ti·∫øp ho·∫∑c th√¥ng qua k√™nh ph√π h·ª£p", "ƒê·ªÉ ng∆∞·ªùi kh√°c x·ª≠ l√Ω"], correctAnswerIndex: 2 },
            { question: "Gi√° tr·ªã Ch√≠nh tr·ª±c c·ªßa c√¥ng ty KH√îNG bao g·ªìm:", answers: ["Trung th·ª±c trong c√¥ng vi·ªác", "D≈©ng c·∫£m n√≥i l√™n ƒëi·ªÅu ƒë√∫ng", "T√¨m c√°ch bao che sai ph·∫°m nh·ªè", "ƒê√°ng tin c·∫≠y v·ªõi ƒë·ªìng nghi·ªáp"], correctAnswerIndex: 2 },
            { question: "N·∫øu b·∫°n h·ª©a ho√†n th√†nh c√¥ng vi·ªác h√¥m nay nh∆∞ng g·∫∑p kh√≥ khƒÉn, b·∫°n s·∫Ω:", answers: ["Xin gia h·∫°n v√† n√™u r√µ l√Ω do", "ƒê√πn ƒë·∫©y cho ƒë·ªìng nghi·ªáp", "L√†m qua loa ƒë·ªÉ k·ªãp ti·∫øn ƒë·ªô", "Kh√¥ng b√°o c√°o v√¨ ng·∫°i"], correctAnswerIndex: 0 },
            { question: "H√†nh vi n√†o th·ªÉ hi·ªán ƒë√∫ng tinh th·∫ßn Tr√°ch nhi·ªám?", answers: ["D√°m nh·∫≠n l·ªói khi m·∫Øc sai s√≥t", "Ch·ªâ l√†m ƒë√∫ng ph·∫ßn vi·ªác c·ªßa m√¨nh, m·∫∑c k·ªá k·∫øt qu·∫£ chung", "Tr√°nh tham gia c√°c c√¥ng vi·ªác kh√≥", "Ch·ªâ b√°o c√°o khi ƒë∆∞·ª£c h·ªèi"], correctAnswerIndex: 0 },
            { question: "Khi l√†m vi·ªác nh√≥m, b·∫°n n√™n ∆∞u ti√™n ƒëi·ªÅu g√¨?", answers: ["K·∫øt qu·∫£ chung c·ªßa nh√≥m", "L·ª£i √≠ch c√° nh√¢n tr∆∞·ªõc ti√™n", "Ho√†n th√†nh ph·∫ßn vi·ªác r·ªìi kh√¥ng c·∫ßn quan t√¢m nh√≥m", "Tr√°nh trao ƒë·ªïi ƒë·ªÉ kh·ªèi m·∫•t th·ªùi gian"], correctAnswerIndex: 0 },
            { question: "M·ªôt nh√≥m l√†m vi·ªác hi·ªáu qu·∫£ ƒë∆∞·ª£c m√¥ t·∫£ ƒë√∫ng nh·∫•t l√†:", answers: ["Ai gi·ªèi th√¨ t·ª± l√†m, ng∆∞·ªùi kh√°c ƒë·ª©ng ngo√†i", "M·ªói ng∆∞·ªùi m·ªôt vai tr√≤, ph·ªëi h·ª£p nh·ªãp nh√†ng", "Ch·ªâ tr∆∞·ªüng nh√≥m quy·∫øt ƒë·ªãnh, th√†nh vi√™n kh√¥ng c·∫ßn √Ω ki·∫øn", "T·∫≠p trung v√†o c√¥ng vi·ªác c·ªßa ph√≤ng ban ri√™ng"], correctAnswerIndex: 1 },
            { question: "Khi kh√°ch h√†ng ph·∫£n √°nh s·∫£n ph·∫©m b·ªã l·ªói, b·∫°n n√™n:", answers: ["Tranh lu·∫≠n ƒë·ªÉ b·∫£o v·ªá c√¥ng ty", "L·∫Øng nghe, ghi nh·∫≠n v√† t√¨m h∆∞·ªõng x·ª≠ l√Ω", "ƒê·ªï l·ªói cho b·ªô ph·∫≠n s·∫£n xu·∫•t", "Im l·∫∑ng cho qua"], correctAnswerIndex: 1 },
            { question: "T·∫≠n t√¢m v·ªõi kh√°ch h√†ng th·ªÉ hi·ªán r√µ nh·∫•t ·ªü:", answers: ["Ch·ªâ quan t√¢m khi kh√°ch h√†ng l·ªõn", "Lu√¥n ƒë·∫∑t s·ª± h√†i l√≤ng kh√°ch h√†ng l√™n h√†ng ƒë·∫ßu", "L√†m theo h·ª£p ƒë·ªìng, kh√¥ng c·∫ßn th√™m h·ªó tr·ª£", "∆Øu ti√™n s·ª± ti·ªán l·ª£i c·ªßa nh√¢n vi√™n h∆°n kh√°ch h√†ng"], correctAnswerIndex: 1 },
            { question: "Khi c√¥ng ty g·∫∑p kh√≥ khƒÉn v·ªÅ th·ªã tr∆∞·ªùng, b·∫°n s·∫Ω:", answers: ["T√¨m c√°ch n√© tr√°nh tr√°ch nhi·ªám", "Ch·∫•p nh·∫≠n th·ª≠ th√°ch, c√πng t√¨m gi·∫£i ph√°p", "ƒê·ª£i l√£nh ƒë·∫°o x·ª≠ l√Ω", "N·∫£n l√≤ng v√† t√¨m c√¥ng ty kh√°c"], correctAnswerIndex: 1 },
            { question: "Tinh th·∫ßn B·∫£n lƒ©nh v∆∞∆°n m√¨nh KH√îNG bao g·ªìm:", answers: ["S√°ng t·∫°o, ƒë·ªïi m·ªõi", "Ki√™n c∆∞·ªùng v∆∞·ª£t kh√≥", "D√°m c·∫°nh tranh qu·ªëc t·∫ø", "Tr√°nh th·ª≠ th√°ch ƒë·ªÉ gi·ªØ an to√†n"], correctAnswerIndex: 3 },
            { question: "Gi√° tr·ªã ‚ÄúCam k·∫øt & Tr√°ch nhi·ªám‚Äù th·ªÉ hi·ªán r√µ nh·∫•t ·ªü h√†nh vi n√†o?", answers: ["Ho√†n th√†nh c√¥ng vi·ªác ƒë√∫ng ti·∫øn ƒë·ªô ƒë√£ h·ª©a", "Ch·ªâ l√†m khi c√≥ c·∫•p tr√™n gi√°m s√°t", "ƒê√πn ƒë·∫©y cho ƒë·ªìng nghi·ªáp khi g·∫∑p kh√≥", "L√†m qua loa ƒë·ªÉ k·ªãp th·ªùi h·∫°n"], correctAnswerIndex: 0 },
            { question: "T·∫°i c√¥ng ty c·ªï ph·∫ßn ·ªëng ƒë·ªìng To√†n Ph√°t, gi√° tr·ªã \"Ch√≠nh tr·ª±c\" ƒë∆∞·ª£c hi·ªÉu l√†:", answers: ["Ch√∫ng ta s·ªëng v√† l√†m vi·ªác trung th·ª±c, c√≥ ƒë·∫°o ƒë·ª©c, ƒë√°ng tin c·∫≠y.", "D≈©ng c·∫£m l√™n ti·∫øng v√† h√†nh ƒë·ªông b·∫£o v·ªá nh·ªØng ƒëi·ªÅu ƒë√∫ng ƒë·∫Øn trong c√¥ng ty. ", "Ch√∫ng ta ch·ªãu ho√†n to√†n tr√°ch nhi·ªám cho c√°c quy·∫øt ƒë·ªãnh, h√†nh ƒë·ªông v√† k·∫øt qu·∫£ c·ªßa m√¨nh. Kh√¥ng ƒë·∫©y tr√°ch nhi·ªám cho ng∆∞·ªùi kh√°c.", "ƒê√°p √°n a v√† c", "ƒê√°p √°n a v√† b"], correctAnswerIndex: 4 },
            { question: "T·∫°i c√¥ng ty c·ªï ph·∫ßn ·ªëng ƒë·ªìng To√†n Ph√°t, gi√° tr·ªã \"ƒê·ªôi h√¨nh hi·ªáu qu·∫£\" ƒë∆∞·ª£c hi·ªÉu:", answers: ["T·ªëi ∆∞u chi ph√≠ v√† ch·∫•t l∆∞·ª£ng ·ªïn ƒë·ªãnh b·∫±ng tinh th·∫ßn k·ª∑ lu·∫≠t v√† √°p d·ª•ng s√°ng ki·∫øn c·∫£i ti·∫øn. Hi·ªáu qu·∫£ ph·∫£i ƒëo l∆∞·ªùng ƒë∆∞·ª£c b·∫±ng d·∫´n ch·ª©ng s·ªë li·ªáu", "L√†m ƒë√∫ng cam k·∫øt b·∫±ng vi·ªác th·ª±c hi·ªán ƒë√∫ng quy tr√¨nh, kh√¥ng l√†m d·ªëi hay l√†m t·∫Øt. L√†m ƒëi·ªÅu hi·ªáu qu·∫£ nh·∫•t cho c√¥ng ty.", "Tuy·ªÉn d·ª•ng ƒë√†o t·∫°o v√† gi·ªØ ch√¢n nh√¢n vi√™n xu·∫•t s·∫Øc trong m·ªôt ƒë·ªôi ng≈© g·∫Øn k·∫øt v·ªõi nhau, ƒë∆∞·ª£c ghi nh·∫≠n v√† t√¥n vinh x·ª©ng ƒë√°ng.", "ƒê√°p √°n a v√† c", "ƒê√°p √°n a v√† b"], correctAnswerIndex: 3 },
            { question: "T·∫°i c√¥ng ty c·ªï ph·∫ßn ·ªëng ƒë·ªìng To√†n Ph√°t, gi√° tr·ªã \"B·∫£n lƒ©nh v∆∞∆°n m√¨nh\" ƒë∆∞·ª£c hi·ªÉu:", answers: ["Li√™n t·ª•c h·ªçc h·ªèi ƒë·ªÉ tr·ªü th√†nh phi√™n b·∫£n t·ªët nh·∫•t c·ªßa ch√≠nh m√¨nh", "Ki√™n c∆∞·ªùng v∆∞·ª£t qua m·ªçi th√°ch th·ª©c", "N·ªó l·ª±c ƒë∆∞a b·∫£n th√¢n v√† doanh nghi·ªáp l√™n t·∫ßm cao m·ªõi", "ƒê√°p √°n a,b,c", "ƒê√°p √°n b v√† c"], correctAnswerIndex: 3 },
            { question: "N·∫øu ƒë·ªìng nghi·ªáp nh·ªù b·∫°n ‚Äúgi·∫•u‚Äù m·ªôt l·ªói nh·ªè ƒë·ªÉ kh√¥ng b·ªã tr·ª´ KPI, b·∫°n s·∫Ω:", answers: ["ƒê·ªìng √Ω ƒë·ªÉ kh√¥ng l√†m m·∫•t l√≤ng", "T·ª´ ch·ªëi v√† ƒë·ªÅ xu·∫•t c√°ch x·ª≠ l√Ω minh b·∫°ch", "Gi·∫•u l·ªói nh∆∞ng ghi ch√∫ trong s·ªï ri√™ng", "Kh√¥ng quan t√¢m"], correctAnswerIndex: 1 },
            { question: "Khi d·ª± √°n g·∫∑p kh√≥ khƒÉn ngo√†i kh·∫£ nƒÉng ki·ªÉm so√°t, b·∫°n s·∫Ω:", answers: ["T√¨m c√°ch n√© tr√°nh", "B√°o c√°o s·ªõm v√† c√πng nh√≥m t√¨m gi·∫£i ph√°p", "Ch·ªù l√£nh ƒë·∫°o x·ª≠ l√Ω", "L∆° ƒëi v√† ti·∫øp t·ª•c c√¥ng vi·ªác kh√°c"], correctAnswerIndex: 1 }
        ];

        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzRqoj6245tM95fweTRXeHH9qnMoDPCApkDU-JEbN_wZg6km3vJL0U-2wXWc-_kelI5/exec';

        // DOM Elements
        const welcomeScreen = document.getElementById('welcome-screen');
        const instructionsScreen = document.getElementById('instructions-screen');
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');

        const welcomeNextBtn = document.getElementById('welcome-next-btn');
        const instructionsNextBtn = document.getElementById('instructions-next-btn');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        const playerNameInput = document.getElementById('playerName');
        const departmentInput = document.getElementById('department');
        const departmentSuggestions = document.getElementById('department-suggestions');
        const nameError = document.getElementById('name-error');
        const currentQuestionNumberEl = document.getElementById('current-question-number');
        const scoreEl = document.getElementById('score');
        const questionEl = document.getElementById('question');
        const answersEl = document.getElementById('answers');
        const imageRevealContainer = document.getElementById('image-reveal-container');
        const imageTilesGrid = document.getElementById('image-tiles-grid');
        
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const effortMessage = document.getElementById('effort-message');
        const finalScoreEl = document.getElementById('final-score');
        const submissionStatusEl = document.getElementById('submission-status');
        const resultImageContainer = document.getElementById('result-image-container');

        // State variables
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let playerName = '';
        let department = '';
        let userAnswers = [];
        let tiles = [];
        let correctAnswersCount = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            playerName = playerNameInput.value.trim();
            department = departmentInput.value.trim();
            if (!playerName || !departments.includes(department)) {
                nameError.classList.remove('hidden');
                return;
            }
            nameError.classList.add('hidden');
            
            questions = [...originalQuestions]; 
            shuffleArray(questions);

            currentQuestionIndex = 0;
            score = 0;
            correctAnswersCount = 0;
            userAnswers = [];
            scoreEl.textContent = score;
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            createImageTiles();
            showQuestion();
        }

        function createImageTiles() {
            imageTilesGrid.innerHTML = '';
            tiles = [];
            for (let i = 0; i < questions.length; i++) {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tiles.push(tile);
                imageTilesGrid.appendChild(tile);
            }
            shuffleArray(tiles);
        }

        function showQuestion() {
            resetState();
            const currentQuestion = questions[currentQuestionIndex];
            currentQuestionNumberEl.textContent = currentQuestionIndex + 1;
            questionEl.textContent = currentQuestion.question;
            currentQuestion.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.innerHTML = `<span>${answer}</span>`;
                button.classList.add('btn', 'answer-btn', 'w-full', 'justify-start', 'p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'text-left', 'hover:bg-gray-100');
                button.dataset.index = index;
                button.addEventListener('click', handleAnswerSelection);
                answersEl.appendChild(button);
            });
        }
        
        function resetState() {
            while (answersEl.firstChild) {
                answersEl.removeChild(answersEl.firstChild);
            }
        }

        function handleAnswerSelection(e) {
            Array.from(answersEl.children).forEach(button => {
                button.disabled = true;
            });

            const selectedButton = e.currentTarget;
            const selectedIndex = parseInt(selectedButton.dataset.index, 10);
            userAnswers[currentQuestionIndex] = selectedButton.textContent;
            
            const currentQ = questions[currentQuestionIndex];
            const correctIndex = currentQ.correctAnswerIndex;
            const correctButton = answersEl.querySelector(`[data-index='${correctIndex}']`);

            if (selectedIndex === correctIndex) {
                selectedButton.classList.add('correct');
                score += 10;
                scoreEl.textContent = score;
                revealTile();
            } else {
                selectedButton.classList.add('incorrect');
                correctButton.classList.add('correct');
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 2000);
        }

        function revealTile() {
            if (correctAnswersCount < tiles.length) {
                tiles[correctAnswersCount].classList.add('revealed');
                correctAnswersCount++;
            }
        }

        function showResult() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            finalScoreEl.textContent = `${score}/${questions.length * 10}`;
            resultImageContainer.innerHTML = ''; 
            const finalImageContainer = imageRevealContainer.cloneNode(true);
            resultImageContainer.appendChild(finalImageContainer);

            if (correctAnswersCount === questions.length) {
                // Win State
                resultIcon.className = 'fa-solid fa-trophy text-7xl text-yellow-400 mb-4';
                resultTitle.textContent = 'Ho√†n Th√†nh!';
                resultMessage.innerHTML = `Ch√∫c m·ª´ng, <span class="font-bold text-blue-600">${playerName}</span>!`;
                effortMessage.classList.add('hidden');
            } else {
                // Lose State
                resultIcon.className = 'fa-solid fa-heart-crack text-7xl text-red-400 mb-4';
                resultTitle.textContent = 'Ch∆∞a Ho√†n Th√†nh!';
                resultMessage.innerHTML = `Ti·∫øc qu√°, <span class="font-bold text-blue-600">${playerName}</span> ∆°i!`;
                effortMessage.textContent = 'H√£y c·ªë g·∫Øng l·∫≠t h·∫øt c√°c m·∫£nh gh√©p ƒë·ªÉ chi·∫øn th·∫Øng nha!';
                effortMessage.classList.remove('hidden');
            }

            submitScore();
        }
        
        function submitScore() {
            if (!WEB_APP_URL) {
                submissionStatusEl.textContent = "Ch∆∞a c·∫•u h√¨nh URL ƒë·ªÉ g·ª≠i ƒëi·ªÉm.";
                submissionStatusEl.classList.add('text-yellow-600');
                return;
            }
            submissionStatusEl.textContent = "ƒêang g·ª≠i k·∫øt qu·∫£...";
            submissionStatusEl.classList.remove('text-green-600', 'text-red-600', 'text-sm');
            restartBtn.disabled = true;

            const formData = new FormData();
            formData.append('H·ªç t√™n', playerName);
            formData.append('B·ªô ph·∫≠n', department);
            for(let i = 0; i < questions.length; i++) {
                const questionText = questions[i].question;
                const userAnswerText = userAnswers[i] || 'Ch∆∞a tr·∫£ l·ªùi';
                formData.append(`C√¢u h·ªèi ${i + 1}`, questionText);
                formData.append(`Tr·∫£ l·ªùi ${i + 1}`, userAnswerText);
            }
            formData.append('ƒêi·ªÉm s·ªë', score);

            fetch(WEB_APP_URL, { method: 'POST', body: formData, })
            .then(response => { if (!response.ok) { throw new Error(`L·ªói m·∫°ng: ${response.statusText}`); } return response.json(); })
            .then(data => {
                if (data.result === 'success') {
                    submissionStatusEl.textContent = "ƒê√£ g·ª≠i k·∫øt qu·∫£ th√†nh c√¥ng!";
                    submissionStatusEl.classList.add('text-green-600');
                } else {
                    throw new Error(JSON.stringify(data.error) || 'L·ªói kh√¥ng x√°c ƒë·ªãnh t·ª´ Google Apps Script');
                }
            })
            .catch(error => {
                console.error('Chi ti·∫øt l·ªói g·ª≠i ƒëi·ªÉm:', error);
                let userMessage = "G·ª≠i k·∫øt qu·∫£ th·∫•t b·∫°i.";
                if (error.message.includes('{}') || error.message.includes('Unexpected token')) {
                    userMessage = "L·ªói! Vui l√≤ng ki·ªÉm tra l·∫°i Google Sheet v√† Apps Script.";
                    submissionStatusEl.classList.add('text-sm');
                } else { userMessage = `G·ª≠i th·∫•t b·∫°i: ${error.message}`; }
                submissionStatusEl.innerHTML = userMessage;
                submissionStatusEl.classList.add('text-red-600');
            })
            .finally(() => {
                restartBtn.disabled = false;
            });
        }

        function restartGame() {
            resultScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            playerNameInput.value = '';
            departmentInput.value = '';
            validateStartForm(); // Ensure button is disabled on restart
        }
        
        function validateStartForm() {
            const departmentValue = departmentInput.value.trim();
            const playerNameValue = playerNameInput.value.trim();
            const isDepartmentValid = departments.includes(departmentValue);

            if (isDepartmentValid && playerNameValue) {
                startBtn.disabled = false;
                startBtn.classList.remove('bg-gray-400', 'opacity-50');
                startBtn.classList.add('bg-blue-600');
            } else {
                startBtn.disabled = true;
                startBtn.classList.remove('bg-blue-600');
                startBtn.classList.add('bg-gray-400', 'opacity-50');
            }
        }


        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', restartGame);

        welcomeNextBtn.addEventListener('click', () => {
            welcomeScreen.classList.add('hidden');
            instructionsScreen.classList.remove('hidden');
        });

        instructionsNextBtn.addEventListener('click', () => {
            instructionsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        departmentInput.addEventListener('input', validateStartForm);
        playerNameInput.addEventListener('input', validateStartForm);

        departmentInput.addEventListener('input', () => {
            const inputText = departmentInput.value.toLowerCase().trim();
            departmentSuggestions.innerHTML = '';
            if (inputText.length === 0) {
                departmentSuggestions.classList.add('hidden');
                return;
            }
            
            const filteredDepartments = departments.filter(dept => 
                dept.toLowerCase().includes(inputText)
            );

            if (filteredDepartments.length > 0) {
                filteredDepartments.forEach(dept => {
                    const item = document.createElement('div');
                    item.textContent = dept;
                    item.classList.add('p-3', 'cursor-pointer', 'hover:bg-gray-100', 'text-left');
                    item.addEventListener('click', () => {
                        departmentInput.value = dept;
                        departmentSuggestions.classList.add('hidden');
                        validateStartForm(); // X√°c th·ª±c sau khi ch·ªçn
                    });
                    departmentSuggestions.appendChild(item);
                });
                departmentSuggestions.classList.remove('hidden');
            } else {
                departmentSuggestions.classList.add('hidden');
            }
        });

        document.addEventListener('click', (e) => {
            if (!departmentInput.contains(e.target) && !departmentSuggestions.contains(e.target)) {
                departmentSuggestions.classList.add('hidden');
            }
        });
        
    </script>
</body>
</html>
